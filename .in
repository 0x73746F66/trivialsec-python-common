#!/usr/bin/env bash
echo -e "\033[0;36m
 _____      _       _       _ __             
/__   \_ __(_)_   _(_) __ _| / _\ ___  ___   
  / /\/ '__| \ \ / / |/ _\` | \ \ / _ \/ __| 
 / /  | |  | |\ V /| | (_| | |\ \  __/ (__   
 \/   |_|  |_| \_/ |_|\__,_|_\__/\___|\___|  
                                             \033[0m"

if [[ ! -z "$(pwd)/bin" ]] && [[ $PATH != *"$(pwd)/bin"* ]]; then
  export PATH="$PATH:$(pwd)/bin"
fi

if [[ ! -z "$(pwd)/src/lib/bin" ]] && [[ $PATH != *"$(pwd)/src/lib/bin"* ]]; then
  export PATH="$PATH:$(pwd)/bin"
fi

if [[ $PATH != *$(npm bin)* ]]; then
  export PATH="$PATH:$(npm bin)"
fi

if [[ -f .env ]]; then
  source .env
fi
echo -e "\033[0;36m"
echo $(make --version)
pip --version
echo $(pylint --version)
echo -e "\033[0m"
git fetch
git status
echo

if [[ -f "$(which git-secrets 2>/dev/null)" ]]; then
  git-secrets --scan
else
  echo "Please install git-secrets"
fi
pip install -q -U pip

if ! [[ -d .venv ]]; then
  python3 -m venv .venv
fi
source .venv/bin/activate
pip install -q -U setuptools pylint wheel awscli
pip install -q -U --no-cache-dir --isolated -r ./requirements.txt
make lint
make package-local
